{% extends "./base.html" %}

{% block main %}
<main>
  {% block page_header %}
  <div id="page-header">
    <h1>My Dashboard</h1>
    <form class="search">
      <label>
        <span hidden>Search</span>
        {{ form.q }}
      </label>
      <input type="submit" class="search-button" aria-label="Search button" value="&#xf002;"/>
    </form>
  </div>
  {% endblock page_header %}

  {% block content %}
  <div class="home">
    {% if query %}
    <h2>{{ object_list.count }} search results for "{{ query }}"</h2>

    <table class="tablesorter" id="search-results-table">
      <thead>
        <tr>
          <th scope="col" data-label="Title">Title</th>
          <th scope="col" data-label="Record type">Record type</th>
          <th scope="col" data-label="Type/level">Type/level</th>
          <th scope="col" data-label="Publication status">Publication status</th>
          <th scope="col" data-label="Updated">Updated</th>
        </tr>
      </thead>
      <tbody>
        {% for result in object_list %}
        <tr>
          {% if result.model_name == 'entity' %}
          <td><a href="{% url 'editor:entity-edit' entity_id=result.pk %}">{{ result.description }}</a></td>
          <td>Entity</td>
          <td>{{ result.entity_type }}</td>
          {% else %}
          <td><a href="{% url 'editor:record-edit' record_id=result.pk %}">{{ result.description|truncatewords:30 }}</a></td>
          <td>Archival Record</td>
          <td>{{ result.archival_level }}</td>
          {% endif %}
          <td>{{ result.publication_status }}</td>
          <td data-text="{{ result.modified.isoformat }}">{{ result.modified }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if object_list.count > 10 %}
      <div id="search-results-pager" class="pager">
        <div class="page-size">
          <p>
            rows per page:
            <a href="#" class="current">10</a>
            {% if object_list.count > 25 %}
            | <a href="#">25</a>
            {% if object_list.count > 50 %}
            | <a href="#">50</a>
              {% if object_list.count > 100 %}
              |  <a href="#">100</a>
              {% endif %}
            {% endif %}
          {% endif %}
          </p>
        </div>
        <div class="page-list">
          <button class="first"><i class="fal fa-step-backward"></i></button>
          <button class="prev"><i class="fal fa-caret-left"></i></button>
          <span class="pagecount"></span>
          <button class="next"><i class="fal fa-caret-right"></i></button>
          <button class="last"><i class="fal fa-step-forward"></i></button>
        </div>
      </div>
    {% endif %}

    <!-- if not search results page -->
    {% else %}
    <h2>Recently modified by me</h2>
    <!-- display table if there are any recently modified records -->
    {% if recently_modified_entities or recently_modified_records %}
      <table id="modified-table" class="tablesorter">
        <thead>
          <tr>
            <th scope="col" data-label="Title" class="filter-match">Title</th>
            <th scope="col" data-label="Record type" class="filter-match">Record type</th>
            <th scope="col" data-label="Type/level" class="filter-match">Type/level</th>
            <th scope="col" data-label="Publication status" class="filter-match">Publication status</th>
            <th scope="col" data-label="Updated" class="filter-match">Updated</th>
          </tr>
        </thead>
        <tbody>
          {% for record in recently_modified_records %}
          <tr>
            <td><a href="{% url 'editor:record-edit' record_id=record.pk %}">{{ record }}</a></td>
            <td>Archival Record</td>
            <td>{{ record.archival_level }}</td>
            <td>{{ record.publication_status }}</td>
            <td data-text="{{ record.modified.isoformat }}" class="{sorter: 'isoDate'}">{{ record.modified }}</td>
          </tr>
          {% endfor %}
          {% for entity in recently_modified_entities %}
          <tr>
            <td><a href="{% url 'editor:entity-edit' entity_id=entity.pk %}">{{ entity }}</a></td>
            <td>Entity</td>
            <td>{{ entity.entity_type }}</td>
            <td>{{ entity.control.publication_status }}</td>
            <td data-text="{{ entity.modified.isoformat }}" class="{sorter: 'isoDate'}">{{ entity.modified }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <!-- if count of records and entities exceeds 10, add pagination -->
      {% if recently_modified_entities.count|add:recently_modified_records.count > 10 %}
        <div id="modified-pager" class="pager">
          <div class="page-size">
            <p>
              rows per page:
              <a href="#" class="current">10</a>
              {% if recently_modified_entities.count|add:recently_modified_records.count > 25 %}
                | <a href="#">25</a>
                {% if recently_modified_entities.count|add:recently_modified_records.count > 50 %}
                | <a href="#">50</a>
                  {% if recently_modified_entities.count|add:recently_modified_records.count > 100 %}
                  | <a href="#">100</a>
                  {% endif%}
                {% endif %}
              {% endif %}
            </p>
          </div>
          <div class="page-list">
            <button class="first"><i class="fal fa-step-backward"></i></button>
            <button class="prev"><i class="fal fa-caret-left"></i></button>
            <span class="pagecount"></span>
            <button class="next"><i class="fal fa-caret-right"></i></button>
            <button class="last"><i class="fal fa-step-forward"></i></button>
          </div>
        </div>
      {% endif %}
      {% else %}
      <p>You don't have recently modified records</p>
    {% endif %}
    
    {% if unpublished_records is not None %}
    <!-- should be available for moderators and admins. Moderators should be able to approve the records for publication and admins should be able to publish them. -->
      <h2>Records for publication</h2>
      <table id="publication-table" class="tablesorter">
          <thead>
            <tr>
              <th scope="col" data-label="Title">Title</th>
              <th scope="col" data-label="Record type">Record type</th>
              <th scope="col" data-label="Type/level">Type/level</th>
              <th scope="col" data-label="Publication status">Publication status</th>
              <th scope="col" data-label="Updated">Updated</th>
            </tr>
          </thead>
          <tbody>
            {% for record in unpublished_records %}
            <tr>
              <td><a href="{% url 'editor:record-edit' record_id=record.pk %}">{{ record }}</a></td>
              <td>Archival Record</td>
              <td>{{ record.archival_level }}</td>
              <td>{{ record.publication_status }}</td>
              <td data-text="{{ record.modified.isoformat }}">{{ record.modified }}</td>
            </tr>
            {% endfor %}
            {% for entity in unpublished_entities %}
            <tr>
              <td><a href="{% url 'editor:entity-edit' entity_id=entity.pk %}">{{ entity }}</a></td>
              <td>Entity</td>
              <td>{{ entity.entity_type }}</td>
              <td>{{ entity.control.publication_status }}</td>
              <td data-text="{{ entity.modified.isoformat }}">{{ entity.modified }}</td>
            </tr>
            {% endfor %}
          </tbody>
      </table>
      <!-- if count of records and entities exceeds 10, add pagination -->
      {% if unpublished_entities.count|add:unpublished_records.count > 10 %}
        <div id="publication-pager" class="pager">
          <div class="page-size">
            <p>
              rows per page:
              <a href="#" class="current">10</a>
              {% if unpublished_entities.count|add:unpublished_records.count > 25 %}
                | <a href="#">25</a>
                {% if unpublished_entities.count|add:unpublished_records.count > 50 %}
                | <a href="#">50</a>
                  {% if unpublished_entities.count|add:unpublished_records.count > 100 %}
                  | <a href="#">100</a>
                  {% endif%}
                {% endif %}
              {% endif %}
            </p>
          </div>
          <div class="page-list">
            <button class="first"><i class="fal fa-step-backward"></i></button>
            <button class="prev"><i class="fal fa-caret-left"></i></button>
            <span class="pagecount"></span>
            <button class="next"><i class="fal fa-caret-right"></i></button>
            <button class="last"><i class="fal fa-step-forward"></i></button>
          </div>
        </div>
      {% endif %}
    {% endif %}
  {% endif %}
  </div>
  {% endblock content %}
</main>
{% endblock main %}
