{% extends "./base.html" %}
{% load editor_form_tags %}

{% block page_header %}
<div id="page-header">
  <h1>Account control panel</h1>
</div>
{% endblock page_header %}

{% block content %}
<div class="user-control">
  <div id="user-details">
    <h2>Personal details</h2>
    <form action="." method="post" class="two-column-table">
      {% csrf_token %}
      <div>
        {% render_field user_form.first_name %}
        {% render_field user_form.email %}
      </div>
      <div>
        {% render_field user_form.last_name %}
      </div>
      <input name="user_submit" type="submit" class="save" value="Save" />
    </form>
  </div>
  <div id="reset">
    <p>Permission level: <span class="highlight">{{ user.editor_profile.get_role_display }}</span></p>
    <!-- display if not admin -->
    <p>Password: ***** <a href="{% url 'editor:reset-password' user_id=user.pk %}" aria-label="change password" class="button-link margin-left"><i class="fas fa-unlock-alt"></i>Change password</a>
  </div>
</div>

{% if all_users_formset %}
<div class="admin">
  <h2>Admin table</h2>

  <form action="." method="post">
    {% csrf_token %}
    {{ all_users_formset.management_form }}
    <table class="admin-table">
      <thead>
        <tr>
          <th scope="col">Username</th>
          <th scope="col">First name</th>
          <th scope="col">Last name</th>
          <th scope="col">Email address</th>
          <th scope="col">Permission level</th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for form in all_users_formset %}
        {% with form_user=form.instance %}
        <tr>
          <td>
            <span class="inline-delete-form-field none">{{ form.DELETE.as_widget }}</span>
            {% render_field form.id %}
            {{ form_user.username }}
          </td>
          <td>{{ form_user.first_name }}</td>
          <td>{{ form_user.last_name }}</td>
          <td>{{ form_user.email }}</td>
          <td>
            {% with profile=form.formsets.editor_profile %}
            {{ profile.management_form }}
            {% render_field profile.forms.0.id %}
            {{ profile.forms.0.role }}
            {% endwith %}
          </td>
          <td class="button-cell">
            <a href="{% url 'editor:reset-password' user_id=user.pk %}" aria-label="change password" class="button-link"><i class="fas fa-unlock-alt"></i>Change password</a>
          </td>
          <td class="button-cell">
            <button aria-label="delete user" class="button-link danger" onclick="deleteField(this)"><i class="fas fa-trash-alt"></i>Delete user</button>
          </td>
        </tr>
        {% endwith %}
        {% endfor %}
      </tbody>
    </table>
    <button aria-label="add user" class="create linked-button" id="add-form"><i class="fal fa-plus"></i>Add user</button>
    <input name="all_users_submit" type="submit" class="save" value="Save" />
  </form>
</div>
  <div class="modal" id="add-user-form">
      <div class="modal-content">
          <div class="modal-header">
              <h2>Create new user</h2>
              <input type="button" class="icon-only" aria-label="close" onclick="closeBlock('modal')" value="&#xf00d;" />
          </div>
          <div class="modal-body">
              <form action="" method="" id="add-new-user">
                  <div class="two-column-table">
                      <div>
                          <label>
                              <span class="required">First name</span>
                              <input type="text" name="first-name"/>
                          </label>
                          <label>
                              <span class="required">Last name</span>
                              <input type="text" name="last-name"/>
                          </label>
                      </div>
                      <div>
                          <label>
                              <span class="required">Email address</span>
                              <input type="email" name="email-address"/>
                          </label>
                          <label>
                              <span class="required">Permission level</span>
                              <select name="permission-level">
                                  <option>Select</option>
                                  <option value="Admin">Admin</option>
                                  <option value="Moderator">Moderator</option>
                                  <option value="Editor">Editor</option>
                                  <option value="Visitor">Visitor</option>
                              </select>
                          </label>
                          <!-- TBD: username? -->
                      </div>
                  </div>
                  <br>
                  <div class="two-column-table">
                    <div>
                        <label>
                            <span class="required">Password</span>
                            <input type="password" name="password"/>
                        </label>
                    </div>
                    <div>
                        <label>
                            <span class="required">Confirm password</span>
                            <input type="password" name="confirm-password"/>
                        </label>
                    </div>
                  </div>
              </form>
          </div>
          <div class="modal-footer">
              <input type="submit" value="Create new user" form="add-new-user" class="save"/>
          </div>
      </div>
</div>
{% endif %}
{% endblock content %}
