{% extends "./base.html" %}
{% block main %}
<main id="duplicates-subpage">
  {% block page_header %}
  <a href="{{ edit_url }}"><i class="fas fa-chevron-left margin-right"></i><span class="dotted-underline">Back to {{ entity|truncatewords:15 }}</span></a>

  <div class="page-header">
    <h2>Manage duplicates of:</h2>
  </div>
  {% endblock page_header %}

  {% block content %}
  {% if error %}
  <div class="error-notification">
    <p>{{ error }}</p>
  </div>
  {% endif %}

  {% if marked or merged %}
  <div class="success-notification">
    <button class="icon-only" aria-label="close notification" onclick="removeNotification()">&#xf00d;</button>
    {% if merged %}
    <h4>The record {{ merged }} was merged into this entity.</h4>
    {% endif %}
    {% if marked %}
    <h4>The record {{ marked }} was marked as "not a duplicate" of this entity.</h4>
    {% endif %}
  </div>
  {% endif %}

  <div class="current-record">
    <h1>{{ entity }}</h1>
    <div class="subitems">
      <ul>
        <li class="highlight">Record ID: {{ entity.id }}</li>
        <li>Type: {{ entity.entity_type }}</li>
        <li>Publication status: {{ publication_status }}</li>
        <li>Updated: {{ last_revision.date_created }} by {{ last_revision.user }}</li>
      </ul>
    </div>
  </div>

  <!-- #add-record-form adds a new duplicate to the duplicates form; the template to append is available in main.js, line 762 -->
  <div id="add-record-form">
    <select name="add_record" class="select-with-search" aria-label="Add a record by record id or display name">
      <option></option>
      <!-- value = [entity.id]; we need to display record id and display name of each record -->
      <option value="29">Record ID: 29, Display name: Prescott, Robert, Maj-Gen.</option>
      <option value="42">Record ID: 42, Display name: Pigot, Hugh, Adm. Hood, Samuel, Rear-Adm. Lord</option>
    </select>
    <button class="create" onclick="addDuplicate()">Add to the list</button>
  </div>

  <div id="duplicates-form">
    <div class="duplicates-list">
      {% if unmarked_duplicates %}
      <p>Merge the following duplicates into the browsed record:</p>
      {% for duplicate in unmarked_duplicates %}
      {% include "./includes/duplicate_entity_entry.html" with duplicate=duplicate unmarked=1 %}
      {% endfor %}
      {% else %}
      <div class="empty-block">
        <p>You don't have duplicates for this record. &#127881;</p>
      </div>
      {% endif %}
    </div>
    {% if marked_duplicates %}
    <input type="checkbox" id="show-removed-checkbox"/>
    <label for="show-removed-checkbox"><span hidden>Show/hide records marked as "not a duplicate":</span></label>
    <div class="manually-removed">
      {% for duplicate in marked_duplicates %}
      {% include "./includes/duplicate_entity_entry.html" with duplicate=duplicate unmarked=0 %}
      {% endfor %}
    </div>
    {% endif %}
  </div>

  <!-- CONFIRMATION POP-UP -->
  <div class="modal" id="confirm-action-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Confirm action</h2>
      </div>
      <div class="modal-body">
        <p class="data-from"></p>
        <span class="action"></span>
        <p class="data-to">Record ID: {{entity.id}} - {{entity}}</p>
      </div>
      <div class="modal-footer">
        <form action="." method="post">
          {% csrf_token %}
          {% for field in duplicate_form %}
          {{ field.as_hidden }}
          {% endfor %}
          <input type="button" value="Cancel" class="default modal-cancel"/>
          <input type="submit" value="Submit" class="save"/>
        </form>
      </div>
    </div>
  </div>
  {% endblock content %}
</main>
{% endblock main %}
