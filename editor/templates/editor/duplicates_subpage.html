{% extends "./base.html" %}
{% block main %}
<main id="duplicates-subpage">
  {% block page_header %}
    <a href="{{ edit_url }}"><i class="fas fa-chevron-left margin-right"></i><span class="dotted-underline">Back to {{ entity|truncatewords:15 }}</span></a>
    {% endblock page_header %}

    {% block content %}
    {% if error %}
    <div class="error-notification">
        <button class="icon-only" aria-label="close notification" onclick="removeNotification()">&#xf00d;</button>
        <p>{{ error }}</p>
    </div>
    {% endif %}

    {% if marked or merged %}
    <div class="success-notification">
      <button class="icon-only" aria-label="close notification" onclick="removeNotification()">&#xf00d;</button>
        {% if merged %}
            <h4>The record (ID: {{ merged }}) was merged into the browsed record (ID: {{ entity.id }}).</h4>
        {% endif %}
        {% if marked %}
            <h4>The record (ID: {{ marked }}) was marked as "not a duplicate" of this entity.</h4>
        {% endif %}
    </div>
    {% endif %}
    <div class="current-record">
        <h2>Manage duplicates of the following browsed record:</h2>
        <h1>{{ entity }}</h1>
        <div class="subitems">
            <ul>
                <li class="highlight">Record ID: {{ entity.id }}</li>
                <li>Type: {{ entity.entity_type }}</li>
                <li>Publication status: {{ publication_status }}</li>
                <li>Updated: {{ last_revision.date_created }} by {{ last_revision.user }}</li>
            </ul>
        </div>
    </div>

    <div class="duplicates-list">
        <p>Merge into the browsed record:</p>
        {% if not added %}
            <form action="." method="get" id="add-record-form">
                {% for field in select_form %}{{ field }}{% endfor %}
                <input type="submit" class="create" value="Add to the list" />
            </form>
        {% endif %}
      {% if unmarked_duplicates %}
        {% for duplicate in unmarked_duplicates %}
            {% include "./includes/duplicate_entity_entry.html" with duplicate=duplicate unmarked=1 added=added %}
        {% endfor %}
      {% endif %}
    </div>
    {% if marked_duplicates %}
    <input type="checkbox" id="show-removed-checkbox"/>
    <label for="show-removed-checkbox"><span hidden>Show/hide records marked as "not a duplicate":</span></label>
    <div class="manually-removed">
      {% for duplicate in marked_duplicates %}
        {% include "./includes/duplicate_entity_entry.html" with duplicate=duplicate unmarked=0 %}
      {% endfor %}
    </div>
    {% endif %}

  <!-- CONFIRMATION POP-UP -->
  <div class="modal" id="merge-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Confirm action</h2>
      </div>
      <div class="modal-body">
        <p class="move-from"></p>
        <span class="action"></span>
        <p class="move-to">Record ID: {{entity.id}} - {{entity}}</p>
      </div>
      <div class="modal-footer">
        <form action="." method="post">
          {% csrf_token %}
          {% for field in duplicate_form %}
          {{ field.as_hidden }}
          {% endfor %}
          <input type="button" value="Cancel" class="default modal-cancel"/>
          <input type="submit" value="Submit" class="save"/>
        </form>
      </div>
    </div>
  </div>
  {% endblock content %}
</main>
{% endblock main %}
