{% extends "./base.html" %}
{% load editor_form_tags %}
{% block main %}
<main>
  {% block page_header %}
  <div class="page-header">
    <h1>Archival records ({{ object_list.count }})</h1>
    <div class="search-filter">
      <form action="." class="search" id="record-search-form" method="get">
          <label>
            <span hidden>Search</span>
            {{ form.q }}
          </label>
          <input type="submit" class="search-button" aria-label="Search button" value="&#xf002;"/>
      </form>
        <div class="filter-block">
          <input type="checkbox" class="none" id="filter" aria-label="Filter">
          <label for="filter" class="filter-button"><span hidden>Filter</span></label>
          <div class="filters-hidden">
            <a href="." class="dotted-underline clear-filters aoctive">Clear all filters</a>
            <div class="filters">
                {% if min_year != None and max_year != None %}
                <fieldset class="filter-list" id="year-range-filter">
                  <legend>Creation year</legend>
                  <div id="year-range"></div>
                  {{ form.start_year }} – {{ form.end_year }}
                  <a href="" class="checkbox-anchor" id="year-range-anchor">Filter</a>
                </fieldset>
                {% endif %}
                {% if facets.fields.archival_level|length > 0 %}
                  <fieldset class="filter-list" id="document-level-filter">
                    <legend>Document level</legend>
                    {% if facets.fields.archival_level|length > 7 %}
                      <input type="text" name="search-archivalLevel" aria-label="search archival level" class="instant-search" placeholder="Search archival level" onfocus="this.placeholder=''" onblur="this.placeholder='Search archival level'"/>
                    {% endif %}
                    {% for archival_level in facets.fields.archival_level %}
                    {% render_facet archival_level %}
                    {% endfor %}
                  </fieldset>
                {% endif %}
                <!-- TODO: 'with transcriptions' filter -->
                <!-- <fieldset class="filter-list" id="has-transcriptions-filter">
                  <legend>Transcriptions</legend>
                  <a href="" class="checkbox-anchor">
                    <input type="checkbox" aria-label="" onclick=''/>Records with transcriptions
                  </a>
                </fieldset> -->
                  
                  <fieldset class="filter-list" id="record-type-filter">
                    <legend>Record type</legend>
                    {% for record_type in facets.fields.record_types %}
                    {% render_facet record_type %}
                    {% endfor %}
                  </fieldset>
                {% if facets.fields.writers|length > 0 %}
                  <fieldset class="filter-list" id="writer-filter">
                    <legend>Writer</legend>
                    {% if facets.fields.writers|length > 7 %}
                      <input type="text" name="search-writer" aria-label="search writer" class="instant-search" placeholder="Search writer" onfocus="this.placeholder=''" onblur="this.placeholder='Search writer'"/>
                    {% endif %}
                    {% for writer in facets.fields.writers %}
                    {% render_facet writer %}
                    {% endfor %}
                  </fieldset>
                {% endif %}
                {% if facets.fields.addressees|length > 0 %}
                  <fieldset class="filter-list" id="addressee-filter">
                    <legend>Addressee</legend>
                    {% if facets.fields.addressees|length > 7 %}
                      <input type="text" name="search-addressee" aria-label="search addressee" class="instant-search" placeholder="Search addressee" onfocus="this.placeholder=''" onblur="this.placeholder='Search addressee'"/>
                    {% endif %}
                    {% for addressee in facets.fields.addressees %}
                    {% render_facet addressee %}
                    {% endfor %}
                  </fieldset>
                {% endif %}
                {% if facets.fields.languages|length > 0 %}
                  <fieldset class="filter-list" id="language-filter">
                    <legend>Language</legend>
                    {% if facets.fields.languages|length > 7 %}
                      <input type="text" name="search-language" aria-label="search language" class="instant-search" placeholder="Search language" onfocus="this.placeholder=''" onblur="this.placeholder='Search language'"/>
                    {% endif %}
                    {% for language in facets.fields.languages %}
                    {% render_facet language %}
                    {% endfor %}
                  </fieldset>
                {% endif %}
              </div>
          </div>
        </div>
    </div>
  </div>
  {% endblock page_header %}

  {% block content %}
  {% if facets.selected or start_year or end_year %}
    <div class="selected-facets">
      <h4>Selected filters</h4>
      <p>
        {% for selected_facet in facets.selected %}
          {% render_facet selected_facet %}
        {% endfor %}
        {% if start_year or end_year %}
        <a href="{{ year_remove_link }}" class="checkbox-anchor">
          <input type="checkbox" aria-label="" checked="checked" onclick='window.location.assign("{{ year_remove_link }}")'/>Year range: {{ start_year }}–{{ end_year }}
        </a>
        {% endif %}
        <a href="." class="dotted-underline clear-filters">Clear all filters</a>
      </p>
    </div>
  {% endif %}
  <div class="table-container">
    {% if query %}
      <h2>Search results for "{{query}}" <a href="." class="dotted-underline clear-filters active mgn-left">Clear search</a></h2>
    {% endif %}
    <table id="records-list-table" class="tablesorter">
        <thead>
          <tr>
            <th scope="col" data-label="Title" data-placeholder="Filter records by title">Title 
              <button class="button-link dotted-underline mgn-left" onclick="showAllMoreInformation(this)">Expand all</button>
            </th>
            <th scope="col" data-label="Writer" data-placeholder="Filter records by writer">Writer</th>
            <th class="filter-select" scope="col" data-label="Level" data-placeholder="Select">Level</th>
            <th class="filter-select" scope="col" data-label="Publication status" data-placeholder="Publication status">Publication status</th>
            <th scope="col" data-label="Updated" class="sorter-sugar" data-placeholder="Filter records by date">Updated</th>
          </tr>
        </thead>
        <tbody>
          {% for result in object_list %}
          <tr>
            <td class="description archival-record">
              <a href="{% url 'editor:record-edit' record_id=result.pk %}">{{ result.description|truncatewords:30 }}</a>
              <label for="checkbox_{{result.pk}}"><span hidden>More information</span></label>
              <input type="checkbox" id="checkbox_{{result.pk}}">
              <div class="more-information">
                - RA reference: {{ result.ra_references|join:"; " }}<br>
                - Creation date: {{ result.creation_date }}
              </div>
            </td>
            <td class="description">{{ result.writers_display|default_if_none:"" }}</td>
            <td>{{ result.archival_level }}</td>
            <td>{{ result.publication_status }}</td>
            <td data-text="{{ result.modified.isoformat }}">{{ result.modified }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
  </div>
  {% if object_list.count > 10 %}
  <div id="records-list-table_pager_info" class="pager">
    <div class="page-size">
      <p>
        rows per page:
        <a href="#"  data-label="10">10</a> 
        {% if object_list.count > 25 %}
          | <a href="#" data-label="25">25</a>
          {% if object_list.count > 50 %}
          | <a href="#" data-label="50">50</a>
            {% if object_list.count > 100 %}
            |  <a href="#" data-label="100">100</a>
            {% endif %}
          {% endif %}
        {% endif %}
      </p>
    </div>
    <div class="page-list">
      <button class="first"><i class="fal fa-step-backward"></i></button>
      <button class="prev"><i class="fal fa-caret-left"></i></button>
      <span class="pagecount"></span>
      <button class="next"><i class="fal fa-caret-right"></i></button>
      <button class="last"><i class="fal fa-step-forward"></i></button>
    </div>
  </div>
  {% endif %}
  {% endblock content %}
</main>
{% endblock main%}
